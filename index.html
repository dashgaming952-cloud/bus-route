<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Bus Search</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Font Awesome Icons -->
  <link
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
    rel="stylesheet"
  >

  <!-- CSS -->
  <link rel="stylesheet" href="style.css">
</head>

<body>

  <div class="glass-card">

    <!-- ‚úÖ CARD HEADER -->
    <div class="card-header">
      <i class="fa-solid fa-bus header-bus"></i>

      <div class="header-title">
        Bus Search
      </div>

      <div class="header-credit">
        From Yeshwanth & Team
      </div>
    </div>

    <p class="subtitle">Search by Route Number or Stop Name</p>

    <!-- Route Input -->
    <div class="input-box">
      <i class="fa-solid fa-road"></i>
      <input
        type="number"
        id="routeNumber"
        placeholder="Enter Route Number"
        oninput="toggleInputs('route')"
      >
    </div>

    <div class="or-divider">OR</div>

    <!-- Stop Input -->
    <div class="input-box">
      <i class="fa-solid fa-location-dot"></i>
      <input
        type="text"
        id="stopName"
        placeholder="Enter Stop Name"
        oninput="toggleInputs('stop')"
      >
    </div>

    <!-- Button -->
    <button id="searchBtn" onclick="searchBus()">Search</button>

    <!-- Output -->
    <div id="output"></div>

  </div>

<script>
function toggleInputs(type) {
  const route = document.getElementById("routeNumber");
  const stop = document.getElementById("stopName");

  if (type === "route" && route.value) {
    stop.value = "";
  }
  if (type === "stop" && stop.value) {
    route.value = "";
  }
}

async function searchBus() {
  const routeNumber = document.getElementById("routeNumber").value;
  const stopName = document.getElementById("stopName").value;
  const output = document.getElementById("output");
  const btn = document.getElementById("searchBtn");

  if (!routeNumber && !stopName) {
    output.innerHTML = "<p class='error'>Please enter Route Number or Stop Name</p>";
    return;
  }

  btn.innerText = "Searching...";
  output.innerHTML = "";

  let url = "/search?";
  if (routeNumber) url += `routeNumber=${routeNumber}&`;
  if (stopName) url += `stop=${stopName}`;

  try {
    const res = await fetch(url);
    const data = await res.json();

    btn.innerText = "Search";

    if (data.error) {
      output.innerHTML = `<p class="error">${data.error}</p>`;
      return;
    }

    data.forEach(bus => {
      output.innerHTML += `
        <div class="result-card">
          <span class="badge">Route ${bus.routeNumber}</span>
          <p>üöå <b>Bus:</b> ${bus.busNumber}</p>
          <p>‚è∞ <b>Start:</b> ${bus.startTime}</p>
          <p>üë®‚Äç‚úàÔ∏è <b>Driver:</b> ${bus.driverName}</p>
          <p>üìû <b>Phone:</b> ${bus.driverPhone}</p>
          <p> <b>Alcohol:</b> ${bus.alcoholLevel}</p>
          <p>üõû <b>Tire:</b> ${bus.tirePressurePSI} PSI</p>
          <p class="stops">${bus.stops.replaceAll("|", " ‚Ä¢ ")}</p>
        </div>
      `;
    });

  } catch (err) {
    btn.innerText = "Search";
    output.innerHTML = "<p class='error'>Server error</p>";
  }
}
</script>
<script src="index.js"></script>

</body>
</html>
